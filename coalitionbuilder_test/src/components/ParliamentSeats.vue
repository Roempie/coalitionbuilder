<template>
  <v-row class="mt-5" >
    <v-spacer></v-spacer>
      <v-col-6>
        <div class="parliament-chart"><svg class="chart"><g ref="svgRef">
          <circle
            v-for="(circle, index) in circles"
            :key="index"
            :cx="circle.cx"
            :cy="circle.cy"
            :r="circle.r"
            :fill="circle.fill"
          ></circle>
          </g><line x1="214.796875" x2="214.796875" y1="4" y2="214.796875" stroke-width="1" stroke="black"></line></svg>
        </div>
      </v-col-6>
    <v-spacer></v-spacer>
    </v-row>
    <v-row>
      <v-spacer></v-spacer>
      <v-col-6>
        <b>Seats: </b> {{ totalSeats }}
      </v-col-6>
      <v-spacer></v-spacer>
    </v-row>
    <!-- <v-col-6> -->
      <v-navigation-drawer permanent width="350" location="right" >
        <v-table density="compact">
          <thead>
            <tr>
              <th class="text-left">
                Party
              </th>
              <th class="text-left">
                Seats
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              v-for="[id, party] in sortedPartiesMap"
              v-bind:key="id"
            >
              <td>
                <v-switch  hide-details="auto"
                  @input="selectParty(party)"
                  :color="party.color"
                  :label="party.name"
                  :value="party.name"
                ></v-switch>
              </td>
              <td>{{ party.seats }}</td>
            </tr>
          </tbody>
        </v-table>
      </v-navigation-drawer>
    <!-- </v-col-6> -->
    <v-spacer></v-spacer>

</template>

<script>

import PartyModel from "./models/PartyModel.js";

export default {
  name: 'ParliamentSeats',
  data() {
    return {
      partiesMap: new Map(),
      totalSeats: 0,
      circles: [
        { cx:"6.343980843127241", cy:"205.81664430984972", r:"6", fill:"#DCE4E9" },
        { cx: "27.382222879361763", cy:"205.8212985935893", r:"6", fill:"#DCE4E9"},
        { cx: "48.42999427300526", cy:"205.82781041935996", r:"6", fill:"#DCE4E9"},
        { cx: "69.49134276281433", cy:"205.83731560034738", r:"6", fill:"#DCE4E9"},
        { cx: "90.57296731812134", cy:"205.85196939092486", r:"6", fill:"#DCE4E9"},
        { cx: "7.814142748786054", cy:"190.33265173430573", r:"6", fill:"#DCE4E9"},
        { cx: "28.998910437216523", cy:"190.4695512361867", r:"6", fill:"#DCE4E9"},
        { cx: "50.22445974223558", cy:"190.6469643925675", r:"6", fill:"#DCE4E9"},
        { cx: "71.50522718279834", cy:"190.885308237794", r:"6", fill:"#DCE4E9"},
        { cx: "10.432853967149384", cy:"175.00105841648082", r:"6", fill:"#DCE4E9"},
        { cx: "31.870962164723352", cy:"175.30244391607567", r:"6", fill:"#DCE4E9"},
        { cx: "53.40121598109906", cy:"175.69415822756017", r:"6", fill:"#DCE4E9"},
        { cx: "14.185583242699835", cy:"159.9069395255756", r:"6", fill:"#DCE4E9"},
        { cx: "75.05348667748805", cy:"176.22147145524463", r:"6", fill:"#DCE4E9"},
        { cx: "35.978972731793874", cy:"160.42245484463893", r:"6", fill:"#DCE4E9"},
        { cx: "57.93358050566013", cy:"161.094984818564", r:"6", fill:"#DCE4E9"},
        { cx: "19.051506642042966", cy:"145.13405248275026", r:"6", fill:"#DCE4E9"},
        { cx: "41.29518591791944", cy:"145.93012228756226", r:"6", fill:"#DCE4E9"},
        { cx: "80.0981262833935", cy:"162.00282644689605", r:"6", fill:"#DCE4E9"},
        { cx: "99.49959646613051", cy:"170.03917852656292", r:"6", fill:"#DCE4E9"},
        { cx: "25.00362310612809", cy:"130.76437219033173", r:"6", fill:"#DCE4E9"},
        { cx: "63.78348469040154", cy:"146.97206679717812", r:"6", fill:"#DCE4E9"},
        { cx: "47.78368215009618", cy:"131.92336526710002", r:"6", fill:"#DCE4E9"},
        { cx: "86.58512771410307", cy:"148.38162726823055", r:"6", fill:"#DCE4E9"},
        { cx: "32.008904279403", cy:"116.87763615223723", r:"6", fill:"#DCE4E9"},
        { cx: "70.90179351749461", cy:"133.44402658983213", r:"6", fill:"#DCE4E9"},
        { cx: "55.400621197329286", cy:"118.49682196154383", r:"6", fill:"#DCE4E9"},
        { cx: "40.02847778449902", cy:"103.55090200974317", r:"6", fill:"#DCE4E9"},
        { cx: "94.44502779115179", cy:"135.5037304909725", r:"6", fill:"#DCE4E9"},
        { cx: "79.22871827586224", cy:"120.62449007411041", r:"6", fill:"#DCE4E9"},
        { cx: "64.0945383819253", cy:"105.74121027207059", r:"6", fill:"#DCE4E9"},
        { cx: "49.017842925453294", cy:"90.85811994784092", r:"6", fill:"#DCE4E9"},
        { cx: "118.5109837358417", cy:"138.4036312494622", r:"6", fill:"#DCE4E9"},
        { cx: "103.59366225966785", cy:"123.50703336266318", r:"6", fill:"#DCE4E9"},
        { cx: "88.69431874365821", cy:"108.62113220251875", r:"6", fill:"#DCE4E9"},
        { cx: "73.80669230618832", cy:"93.74271487736956", r:"6", fill:"#DCE4E9"},
        { cx: "58.92711762252918", cy:"78.86972234489804", r:"6", fill:"#DCE4E9"},
        { cx: "75.86972234489807", cy:"61.92711762252915", r:"6", fill:"#DCE4E9"},
        { cx: "90.7427148773696", cy:"76.80669230618832", r:"6", fill:"#DCE4E9"},
        { cx: "105.62113220251878", cy:"91.69431874365819", r:"6", fill:"#DCE4E9"},
        { cx: "120.5070333626632", cy:"106.59366225966784", r:"6", fill:"#DCE4E9"},
        { cx: "135.4036312494622", cy:"121.51098373584169", r:"6", fill:"#DCE4E9"},
        { cx: "87.85811994784088", cy:"52.01784292545332", r:"6", fill:"#DCE4E9"},
        { cx: "102.74121027207063", cy:"67.09453838192528", r:"6", fill:"#DCE4E9"},
        { cx: "117.62449007411045", cy:"82.22871827586224", r:"6", fill:"#DCE4E9"},
        { cx: "132.50373049097254", cy:"97.44502779115177", r:"6", fill:"#DCE4E9"},
        { cx: "100.55090200974321", cy:"43.02847778449899", r:"6", fill:"#DCE4E9"},
        { cx: "115.49682196154387", cy:"58.40062119732926", r:"6", fill:"#DCE4E9"},
        { cx: "130.44402658983222", cy:"73.90179351749455", r:"6", fill:"#DCE4E9"},
        { cx: "113.87763615223727", cy:"35.00890427940297", r:"6", fill:"#DCE4E9"},
        { cx: "145.38162726823055", cy:"89.58512771410307", r:"6", fill:"#DCE4E9"},
        { cx: "155.88318709401142", cy:"107.78125162276599", r:"6", fill:"#DCE4E9"},
        { cx: "128.92336526710005", cy:"50.78368215009618", r:"6", fill:"#DCE4E9"},
        { cx: "143.97206679717817", cy:"66.78348469040154", r:"6", fill:"#DCE4E9"},
        { cx: "127.76437219033177", cy:"28.00362310612809", r:"6", fill:"#DCE4E9"},
        { cx: "142.93012228756228", cy:"44.29518591791944", r:"6", fill:"#DCE4E9"},
        { cx: "159.00282644689605", cy:"83.0981262833935", r:"6", fill:"#DCE4E9"},
        { cx: "142.13405248275023", cy:"22.051506642042966", r:"6", fill:"#DCE4E9"},
        { cx: "158.09498481856403", cy:"60.93358050566013", r:"6", fill:"#DCE4E9"},
        { cx: "157.42245484463896", cy:"38.978972731793846", r:"6", fill:"#DCE4E9"},
        { cx: "178.66234989652506", cy:"98.34581345046011", r:"6", fill:"#DCE4E9"},
        { cx: "173.22147145524463", cy:"78.05348667748805", r:"6", fill:"#DCE4E9"},
        { cx: "156.90693952557564", cy:"17.185583242699835", r:"6", fill:"#DCE4E9"},
        { cx: "172.6941582275602", cy:"56.40121598109906", r:"6", fill:"#DCE4E9"},
        { cx: "172.3024439160757", cy:"34.87096216472332", r:"6", fill:"#DCE4E9"},
        { cx: "172.00105841648082", cy:"13.432853967149384", r:"6", fill:"#DCE4E9"},
        { cx: "187.885308237794", cy:"74.50522718279834", r:"6", fill:"#DCE4E9"},
        { cx: "187.64696439256755", cy:"53.22445974223558", r:"6", fill:"#DCE4E9"},
        { cx: "187.46955123618673", cy:"31.998910437216523", r:"6", fill:"#DCE4E9"},
        { cx: "187.33265173430567", cy:"10.814142748786054", r:"6", fill:"#DCE4E9"},
        { cx: "202.85196939092492", cy:"93.57296731812136", r:"6", fill:"#DCE4E9"},
        { cx: "202.83731560034738", cy:"72.49134276281433", r:"6", fill:"#DCE4E9"},
        { cx: "202.82781041936002", cy:"51.42999427300526", r:"6", fill:"#DCE4E9"},
        { cx: "202.82129859358932", cy:"30.382222879361763", r:"6", fill:"#DCE4E9"},
        { cx: "202.81664430984972", cy:"9.343980843127241", r:"6", fill:"#DCE4E9"},
        { cx: "226.7771056901503", cy:"9.343980843127241", r:"6", fill:"#DCE4E9"},
        { cx: "226.7724514064107", cy:"30.382222879361763", r:"6", fill:"#DCE4E9"},
        { cx: "226.76593958064", cy:"51.42999427300526", r:"6", fill:"#DCE4E9"},
        { cx: "226.75643439965265", cy:"72.49134276281433", r:"6", fill:"#DCE4E9"},
        { cx: "226.7417806090751", cy:"93.57296731812136", r:"6", fill:"#DCE4E9"},
        { cx: "242.26109826569436", cy:"10.814142748786054", r:"6", fill:"#DCE4E9"},
        { cx: "242.1241987638133", cy:"31.998910437216523", r:"6", fill:"#DCE4E9"},
        { cx: "241.94678560743245", cy:"53.22445974223558", r:"6", fill:"#DCE4E9"},
        { cx: "241.708441762206", cy:"74.50522718279834", r:"6", fill:"#DCE4E9"},
        { cx: "257.59269158351924", cy:"13.432853967149384", r:"6", fill:"#DCE4E9"},
        { cx: "257.2913060839243", cy:"34.87096216472335", r:"6", fill:"#DCE4E9"},
        { cx: "256.8995917724398", cy:"56.40121598109906", r:"6", fill:"#DCE4E9"},
        { cx: "272.68681047442436", cy:"17.185583242699835", r:"6", fill:"#DCE4E9"},
        { cx: "256.37227854475543", cy:"78.05348667748808", r:"6", fill:"#DCE4E9"},
        { cx: "250.93140010347494", cy:"98.34581345046013", r:"6", fill:"#DCE4E9"},
        { cx: "272.17129515536107", cy:"38.978972731793846", r:"6", fill:"#DCE4E9"},
        { cx: "271.498765181436", cy:"60.93358050566013", r:"6", fill:"#DCE4E9"},
        { cx: "287.45969751724977", cy:"22.051506642042966", r:"6", fill:"#DCE4E9"},
        { cx: "286.66362771243774", cy:"44.29518591791944", r:"6", fill:"#DCE4E9"},
        { cx: "270.59092355310395", cy:"83.0981262833935", r:"6", fill:"#DCE4E9"},
        { cx: "301.82937780966824", cy:"28.00362310612809", r:"6", fill:"#DCE4E9"},
        { cx: "285.6216832028218", cy:"66.78348469040154", r:"6", fill:"#DCE4E9"},
        { cx: "300.67038473289995", cy:"50.78368215009618", r:"6", fill:"#DCE4E9"},
        { cx: "273.71056290598864", cy:"107.78125162276602", r:"6", fill:"#DCE4E9"},
        { cx: "284.2121227317694", cy:"89.58512771410304", r:"6", fill:"#DCE4E9"},
        { cx: "315.7161138477628", cy:"35.008904279403", r:"6", fill:"#DCE4E9"},
        { cx: "299.14972341016784", cy:"73.90179351749458", r:"6", fill:"#DCE4E9"},
        { cx: "314.09692803845616", cy:"58.400621197329286", r:"6", fill:"#DCE4E9"},
        { cx: "329.0428479902568", cy:"43.02847778449899", r:"6", fill:"#DCE4E9"},
        { cx: "297.0900195090275", cy:"97.44502779115179", r:"6", fill:"#DCE4E9"},
        { cx: "311.9692599258896", cy:"82.22871827586226", r:"6", fill:"#DCE4E9"},
        { cx: "326.8525397279294", cy:"67.09453838192528", r:"6", fill:"#DCE4E9"},
        { cx: "341.7356300521591", cy:"52.017842925453294", r:"6", fill:"#DCE4E9"},
        { cx: "294.19011875053786", cy:"121.51098373584172", r:"6", fill:"#DCE4E9"},
        { cx: "309.0867166373368", cy:"106.59366225966784", r:"6", fill:"#DCE4E9"},
        { cx: "323.97261779748123", cy:"91.69431874365821", r:"6", fill:"#DCE4E9"},
        { cx: "338.85103512263044", cy:"76.80669230618832", r:"6", fill:"#DCE4E9"},
        { cx: "353.72402765510196", cy:"61.92711762252915", r:"6", fill:"#DCE4E9"},
        { cx: "370.6666323774708", cy:"78.86972234489807", r:"6", fill:"#DCE4E9"},
        { cx: "355.7870576938117", cy:"93.74271487736956", r:"6", fill:"#DCE4E9"},
        { cx: "340.8994312563418", cy:"108.62113220251875", r:"6", fill:"#DCE4E9"},
        { cx: "326.00008774033216", cy:"123.50703336266321", r:"6", fill:"#DCE4E9"},
        { cx: "311.0827662641583", cy:"138.4036312494622", r:"6", fill:"#DCE4E9"},
        { cx: "380.5759070745467", cy:"90.85811994784092", r:"6", fill:"#DCE4E9"},
        { cx: "365.4992116180747", cy:"105.7412102720706", r:"6", fill:"#DCE4E9"},
        { cx: "350.36503172413774", cy:"120.62449007411041", r:"6", fill:"#DCE4E9"},
        { cx: "335.1487222088482", cy:"135.5037304909725", r:"6", fill:"#DCE4E9"},
        { cx: "389.565272215501", cy:"103.55090200974321", r:"6", fill:"#DCE4E9"},
        { cx: "374.19312880267074", cy:"118.49682196154384", r:"6", fill:"#DCE4E9"},
        { cx: "358.6919564825054", cy:"133.4440265898322", r:"6", fill:"#DCE4E9"},
        { cx: "397.584845720597", cy:"116.87763615223723", r:"6", fill:"#DCE4E9"},
        { cx: "343.008622285897", cy:"148.3816272682306", r:"6", fill:"#DCE4E9"},
        { cx: "381.8100678499038", cy:"131.92336526710005", r:"6", fill:"#DCE4E9"},
        { cx: "365.81026530959844", cy:"146.97206679717817", r:"6", fill:"#DCE4E9"},
        { cx: "404.5901268938719", cy:"130.76437219033178", r:"6", fill:"#DCE4E9"},
        { cx: "388.2985640820806", cy:"145.93012228756228", r:"6", fill:"#DCE4E9"},
        { cx: "330.0941535338695", cy:"170.03917852656292", r:"6", fill:"#DCE4E9"},
        { cx: "349.4956237166065", cy:"162.00282644689605", r:"6", fill:"#DCE4E9"},
        { cx: "410.54224335795703", cy:"145.13405248275026", r:"6", fill:"#DCE4E9"},
        { cx: "371.66016949433987", cy:"161.094984818564", r:"6", fill:"#DCE4E9"},
        { cx: "393.6147772682061", cy:"160.42245484463893", r:"6", fill:"#DCE4E9"},
        { cx: "354.5402633225119", cy:"176.2214714552446", r:"6", fill:"#DCE4E9"},
        { cx: "415.4081667573002", cy:"159.90693952557567", r:"6", fill:"#DCE4E9"},
        { cx: "376.1925340189009", cy:"175.6941582275602", r:"6", fill:"#DCE4E9"},
        { cx: "397.7227878352767", cy:"175.30244391607567", r:"6", fill:"#DCE4E9"},
        { cx: "419.1608960328506", cy:"175.00105841648082", r:"6", fill:"#DCE4E9"},
        { cx: "358.0885228172017", cy:"190.885308237794", r:"6", fill:"#DCE4E9"},
        { cx: "379.3692902577644", cy:"190.64696439256755", r:"6", fill:"#DCE4E9"},
        { cx: "400.5948395627835", cy:"190.4695512361867", r:"6", fill:"#DCE4E9"},
        { cx: "421.779607251214", cy:"190.33265173430567", r:"6", fill:"#DCE4E9"},
        { cx: "339.02078268187864", cy:"205.8519693909249", r:"6", fill:"#DCE4E9"},
        { cx: "360.1024072371857", cy:"205.83731560034738", r:"6", fill:"#DCE4E9"},
        { cx: "381.16375572699474", cy:"205.82781041936", r:"6", fill:"#DCE4E9"},
        { cx: "402.21152712063827", cy:"205.8212985935893", r:"6", fill:"#DCE4E9"},
        { cx: "423.24976915687273", cy:"205.81664430984972", r:"6", fill:"#DCE4E9"},
      ]
    };
  },
  beforeMount() {
    this.createParties();
  },
  
  methods: {
    createParties() {
      
      // Empty all seats
      this.emptySeats();

      // Instantiate variables 
      this.partiesMap.clear();

      // Create party and fill partymap
      for(let i = 0; i < 7; i++) {
        let party = PartyModel.createSampleParty();
        this.partiesMap.set(party.id, party)
      }
    },

    selectParty(party) {

      // Switch coalition boolean and update map
      party.inCoalition = !party.inCoalition;
      this.partiesMap.set(party.id, party);
      
    },

    emptySeats() {
      for(let i = 0; i < this.circles.length; i++) {
          this.circles[i].fill = "#DCE4E9";
      }
    },
  },
  watch: {
    partiesMap: {
      handler() {
        
        // Empty all seats
        this.emptySeats();

        // Color seats
        let offset = 0;
        this.totalSeats = 0;
        for (const [_, value] of this.sortedPartiesMap.entries()) {
          _;
          if(value.inCoalition) {
            this.totalSeats += value.seats;

            for(let i = 0; i < value.seats; i++) {
              this.circles[offset].fill = value.color;
              offset++;
            }
          }
        }
      },
       deep: true
    }
  },
  computed: {
    sortedPartiesMap() {
      return new Map([...this.partiesMap.entries()].sort((a, b) => b[1].seats - a[1].seats));
    }
}
}

</script>
<style>

.parliament-chart .chart {
    width: 440px;
    height: 220px;
    height: 0;
    padding-bottom: 50%;
    overflow: visible;
}

</style>
